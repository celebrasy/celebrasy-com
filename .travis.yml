sudo: required

language: ruby
rvm:
  - 2.2.1
before_script:
  - RAILS_ENV=test bundle exec rake db:create db:migrate

services:
  - docker

before_install:
  - curl -L https://github.com/docker/compose/releases/download/1.4.0/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

script:
  - bundle exec bin/rspec
  - HEADLESS=true bundle exec bin/cucumber

after_success:
  - docker login -e="$DOCKER_EMAIL" -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
  - docker-compose build
  - export IMAGE_SHA=`docker images -q com_web`
  - docker tag "${IMAGE_SHA}" "celebrasy/com:${TRAVIS_COMMIT}"
  - docker push celebrasy/com

addons:
  code_climate:
    repo_token: 97d1ac04ffd9a627187c971bd18d9e4367da327ac5512fb3b835234bf57ffbf1
